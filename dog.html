<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Plays Catch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-color: #87CEEB;
            touch-action: none;
        }
        
        /* Cloud styling */
        .cloud {
            position: absolute;
            background-color: #fff;
            border-radius: 50px;
            z-index: 1;
            opacity: 0.9;
        }
        
        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
        }
        
        #cloud1 {
            width: 120px;
            height: 40px;
            top: 15%;
            left: 20%;
        }
        
        #cloud1::before {
            width: 60px;
            height: 60px;
            top: -30px;
            left: 15px;
        }
        
        #cloud1::after {
            width: 80px;
            height: 80px;
            top: -40px;
            right: 15px;
        }
        
        #cloud2 {
            width: 180px;
            height: 50px;
            top: 10%;
            right: 25%;
        }
        
        #cloud2::before {
            width: 70px;
            height: 70px;
            top: -35px;
            left: 20px;
        }
        
        #cloud2::after {
            width: 100px;
            height: 100px;
            top: -50px;
            right: 30px;
        }
        
        #cloud3 {
            width: 150px;
            height: 45px;
            top: 25%;
            left: 60%;
        }
        
        #cloud3::before {
            width: 65px;
            height: 65px;
            top: -32px;
            left: 18px;
        }
        
        #cloud3::after {
            width: 90px;
            height: 90px;
            top: -45px;
            right: 25px;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20vh;
            background-color: #7CFC00;
        }
        
        /* Tree styling */
        #tree {
            position: absolute;
            z-index: 2;
            bottom: 20vh; /* Position at ground level */
            right: 15%; /* Position on the right side */
        }
        
        #tree-trunk {
            width: 20px;
            height: 80px;
            background-color: #8B4513;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #tree-top {
            width: 120px;
            height: 160px;
            background-color: #228B22;
            border-radius: 60px;
            position: absolute;
            bottom: 65px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #tree-top2 {
            width: 80px;
            height: 100px;
            background-color: #228B22;
            border-radius: 40px;
            position: absolute;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #dog {
            position: absolute;
            width: 50px;
            height: 40px;
            background-color: #8B4513;
            border-radius: 10px;
            bottom: 20vh;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
        
        #dog-head {
            position: absolute;
            width: 25px;
            height: 20px;
            background-color: #8B4513;
            border-radius: 50%;
            top: -15px;
            left: 0;
        }
        
        #dog-ear1, #dog-ear2 {
            position: absolute;
            width: 15px;
            height: 20px;
            background-color: #8B4513;
            border-radius: 50%;
            top: -15px;
        }
        
        #dog-ear1 {
            left: -5px;
        }
        
        #dog-ear2 {
            right: -5px;
        }
        
        #dog-tail {
            position: absolute;
            width: 20px;
            height: 8px;
            background-color: #8B4513;
            border-radius: 5px;
            right: -15px;
            top: 10px;
        }
        
        #frisbee {
            position: absolute;
            width: 40px;
            height: 6px; /* Thinner height for a flatter disc appearance */
            background-color: #FF4500; /* Brighter orange */
            border-radius: 50%;
            border: 2px solid #FF6347;
            top: -100px;
            left: -100px;
            z-index: 5;
            transform: rotate(0deg);
            box-shadow: 0 -2px 3px rgba(0,0,0,0.2); /* Shadow on bottom to create depth */
            perspective: 1000px;
            transform-style: preserve-3d;
            backface-visibility: visible;
        }
        
        #frisbee::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.2) 70%, transparent 100%);
            border-radius: 50%;
            top: -5px;
            left: 12px;
            z-index: 2;
        }
        
        #man {
            position: absolute;
            bottom: 20vh;
            left: 20%;
            z-index: 5;
        }
        
        #man-head {
            width: 20px;
            height: 20px;
            background-color: #FFD700;
            border-radius: 50%;
            position: absolute;
            top: -80px;
        }
        
        #man-body {
            width: 5px;
            height: 50px;
            background-color: #000;
            position: absolute;
            top: -60px;
            left: 8px;
        }
        
        #man-arm1, #man-arm2 {
            width: 30px;
            height: 5px;
            background-color: #000;
            position: absolute;
            top: -45px;
            left: 13px;
            transform-origin: 0 50%;
            transform: rotate(0deg);
        }
        
        #man-arm2 {
            transform: rotate(-45deg);
        }
        
        #man-leg1, #man-leg2 {
            width: 5px;
            height: 30px;
            background-color: #000;
            position: absolute;
            top: -10px;
            transition: transform 0.2s ease-out;
        }
        
        #man-leg1 {
            left: 0;
            transform: rotate(-15deg);
        }
        
        #man-leg2 {
            left: 15px;
            transform: rotate(15deg);
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            z-index: 100;
        }
        
        .screen h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .screen p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 5px;
        }
        
        .button:hover {
            background-color: #45a049;
        }
        
        .hidden {
            display: none;
        }
        
        #game-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 20;
        }
        
        .bark-bubble {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            padding: 5px;
            opacity: 1;
            transition: opacity 0.5s;
            z-index: 15;
        }
        
        .rain-drop {
            position: absolute;
            width: 2px;
            height: 10px;
            background-color: #1E90FF;
            z-index: 3;
        }
        
        #high-scores {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            width: 80%;
        }
        
        #high-scores-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #high-scores-table th, #high-scores-table td {
            padding: 5px;
            border: 1px solid white;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Add clouds to the background -->
        <div id="cloud1" class="cloud"></div>
        <div id="cloud2" class="cloud"></div>
        <div id="cloud3" class="cloud"></div>
        
        <div id="start-screen" class="screen">
            <h1>Dog Plays Catch</h1>
            <p>Control the dog with your mouse or touch to catch the frisbee.<br>
            Click/tap to bark and make the man throw the frisbee.<br>
            Don't let the frisbee hit the ground!</p>
            <button id="start-button" class="button">Start Game</button>
            <div id="high-scores">
                <h2>High Scores</h2>
                <table id="high-scores-table">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Score</th>
                            <th>Wind</th>
                            <th>Rain</th>
                        </tr>
                    </thead>
                    <tbody id="high-scores-body">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="game-over-screen" class="screen hidden">
            <h1>Game Over!</h1>
            <p id="game-over-stats">You reached level: 1<br>Your score: 0</p>
            <button id="restart-button" class="button">Play Again</button>
            <button id="home-button-1" class="button">Home</button>
        </div>
        
        <div id="level-complete-screen" class="screen hidden">
            <h1>Level Complete!</h1>
            <p id="level-stats">Level: 1<br>Score: 0</p>
            <button id="next-level-button" class="button">Next Level</button>
            <button id="home-button-2" class="button">Home</button>
        </div>
        
        <div id="game-info">
            <p>Level: <span id="level-display">1</span></p>
            <p>Score: <span id="score-display">0</span></p>
            <p>Wind: <span id="wind-display">5%</span></p>
            <p>Rain: <span id="rain-display">0%</span></p>
            <p>Timer: <span id="timer-display">0.0</span>s</p>
        </div>
        
        <div id="ground"></div>
        
        <!-- Add tree to background -->
        <div id="tree">
            <div id="tree-trunk"></div>
            <div id="tree-top"></div>
            <div id="tree-top2"></div>
        </div>
        
        <div id="dog">
            <div id="dog-head"></div>
            <div id="dog-ear1"></div>
            <div id="dog-ear2"></div>
            <div id="dog-tail"></div>
        </div>
        
        <div id="frisbee"></div>
        
        <div id="man">
            <div id="man-head"></div>
            <div id="man-body"></div>
            <div id="man-arm1"></div>
            <div id="man-arm2"></div>
            <div id="man-leg1"></div>
            <div id="man-leg2"></div>
        </div>
    </div>

    <script>
        // Game variables
        let currentLevel = 1;
        let score = 0;
        let windPercent = 5;
        let rainPercent = 0;
        let gameActive = false;
        let frisbeeActive = false;
        let frisbeeThrown = false;
        let frisbeeTimer = 0;
        let frisbeeX = 0;
        let frisbeeY = 0;
        let frisbeeVelocityX = 0;
        let frisbeeVelocityY = 0;
        let frisbeeRotation = 0;
        let frisbeeWobble = 0;
        let dogX = window.innerWidth / 2;
        let dogY = window.innerHeight - window.innerHeight * 0.2;
        let manX = window.innerWidth * 0.2;
        let raindrops = [];
        let lastFrameTime = 0;
        let deltaTime = 0;
        let barking = false;
        let barkCooldown = 0;
        let canThrow = true;
        
        // Cloud animation variables
        let clouds = [];
        let cloudSpeeds = [];
        
        // DOM elements
        const gameContainer = document.getElementById('game-container');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const levelCompleteScreen = document.getElementById('level-complete-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const nextLevelButton = document.getElementById('next-level-button');
        const homeButton1 = document.getElementById('home-button-1');
        const homeButton2 = document.getElementById('home-button-2');
        const levelDisplay = document.getElementById('level-display');
        const scoreDisplay = document.getElementById('score-display');
        const windDisplay = document.getElementById('wind-display');
        const rainDisplay = document.getElementById('rain-display');
        const timerDisplay = document.getElementById('timer-display');
        const gameOverStats = document.getElementById('game-over-stats');
        const levelStats = document.getElementById('level-stats');
        const highScoresBody = document.getElementById('high-scores-body');
        const ground = document.getElementById('ground');
        const dog = document.getElementById('dog');
        const frisbee = document.getElementById('frisbee');
        const man = document.getElementById('man');
        const manArm1 = document.getElementById('man-arm1');
        const manArm2 = document.getElementById('man-arm2');
        
        // Initialize game
        function initGame() {
            // Set position of man
            man.style.left = `${manX}px`;
            
            // Initialize clouds
            initializeClouds();
            
            // Load game progress from localStorage
            loadGameProgress();
            
            // Display high scores
            displayHighScores();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Initialize clouds
        function initializeClouds() {
            clouds = [
                document.getElementById('cloud1'),
                document.getElementById('cloud2'),
                document.getElementById('cloud3')
            ];
            
            // Set very slow initial speeds for clouds (almost standing still)
            cloudSpeeds = [
                0.05 + Math.random() * 0.05,
                0.03 + Math.random() * 0.04,
                0.04 + Math.random() * 0.05
            ];
            
            // Set initial positions
            clouds.forEach((cloud, index) => {
                cloud.style.left = `${Math.random() * 80}%`;
            });
        }
        
        // Update clouds
        function updateClouds(dt) {
            clouds.forEach((cloud, index) => {
                let left = parseFloat(cloud.style.left) || 0;
                
                // Move cloud based on wind and its own speed
                // Very minimal movement at low wind levels, more noticeable at higher winds
                const windInfluence = windPercent / 100; // Moderate wind impact
                const speed = cloudSpeeds[index] * (1 + windInfluence) * 5; // Very low base speed
                
                left += speed * dt;
                
                // Loop clouds back to left side when they go off screen
                if (left > 100) {
                    left = -20;
                }
                
                cloud.style.left = `${left}%`;
            });
        }
        
        // Set up event listeners
        function setupEventListeners() {
            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', restartGame);
            nextLevelButton.addEventListener('click', nextLevel);
            homeButton1.addEventListener('click', goHome);
            homeButton2.addEventListener('click', goHome);
            
            // Detect mobile device
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            // Mouse/touch move events for dog control
            document.addEventListener('mousemove', moveDog);
            document.addEventListener('touchmove', moveDogTouch, { passive: false });
            
            // Click/tap events for barking
            document.addEventListener('mousedown', bark);
            document.addEventListener('touchstart', bark);
            
            // Add passive flag to prevent warnings on mobile browsers
            if (isMobile) {
                // Prevent scrolling when playing
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                document.body.style.height = '100%';
            }
        }
        
        // Movement handlers
        function moveDog(e) {
            if (gameActive) {
                dogX = e.clientX;
                
                // Keep dog within bounds
                if (dogX < 25) dogX = 25;
                if (dogX > window.innerWidth - 25) dogX = window.innerWidth - 25;
                
                dog.style.left = `${dogX}px`;
            }
        }
        
        function moveDogTouch(e) {
            if (gameActive) {
                e.preventDefault();
                const touchX = e.touches[0].clientX;
                dogX = touchX;
                
                // Keep dog within bounds
                if (dogX < 25) dogX = 25;
                if (dogX > window.innerWidth - 25) dogX = window.innerWidth - 25;
                
                // Update dog position immediately
                dog.style.left = `${dogX}px`;
                
                // Check if dog catches frisbee when moving
                if (frisbeeActive && frisbeeThrown) {
                    checkFrisbeeCatch();
                }
            }
        }
        
        // Bark function
        function bark(e) {
            if (gameActive && !barking && barkCooldown <= 0) {
                barking = true;
                barkCooldown = 1; // Cooldown in seconds
                
                // Create bark bubble
                const bubble = document.createElement('div');
                bubble.className = 'bark-bubble';
                bubble.textContent = 'WOOF!';
                bubble.style.left = `${parseInt(dog.style.left) + 25}px`;
                bubble.style.top = `${dogY - 60}px`;
                gameContainer.appendChild(bubble);
                
                // Fade out and remove bark bubble
                setTimeout(() => {
                    bubble.style.opacity = '0';
                    setTimeout(() => {
                        gameContainer.removeChild(bubble);
                    }, 500);
                }, 500);
                
                // Trigger frisbee throw if man can throw
                if (canThrow && !frisbeeActive) {
                    throwFrisbee();
                }
                
                // Clear barking state
                setTimeout(() => {
                    barking = false;
                }, 500);
            }
        }
        
        // Throw frisbee
        function throwFrisbee() {
            if (!frisbeeActive) {
                frisbeeActive = true;
                frisbeeThrown = false;
                frisbeeTimer = 0;
                
                // Set initial position
                frisbeeX = manX + 30;
                frisbeeY = window.innerHeight - window.innerHeight * 0.2 - 50;
                
                // Calculate distance between dog and man for animation speed
                const dogDistance = Math.abs(dogX - manX);
                const maxDistance = window.innerWidth * 0.7;
                const distanceFactor = Math.min(1, dogDistance / maxDistance);
                
                // Initial man position for animation
                const initialManLegPosition = {
                    leg1: document.getElementById('man-leg1').style.transform,
                    leg2: document.getElementById('man-leg2').style.transform
                };
                
                // Animation for throwing - faster windup for farther throws
                let throwAnimFrame = 0;
                const throwSpeed = 1 + distanceFactor; // Animation speeds up with distance
                let throwAnim = setInterval(() => {
                    throwAnimFrame++;
                    
                    // Animate man's arm for throwing with more windup for distance
                    const windupAngle = -45 - (distanceFactor * 20); // More windup for farther throws
                    manArm2.style.transform = `rotate(${windupAngle + throwAnimFrame * (10 + distanceFactor * 5)}deg)`;
                    
                    // Animate man taking a step (leg movement)
                    if (throwAnimFrame < 5) {
                        // Start stepping forward
                        document.getElementById('man-leg1').style.transform = `rotate(-25deg)`;
                        document.getElementById('man-leg2').style.transform = `rotate(25deg)`;
                    } else {
                        // Complete the step
                        document.getElementById('man-leg1').style.transform = `rotate(-5deg)`;
                        document.getElementById('man-leg2').style.transform = `rotate(30deg)`;
                    }
                    
                    if (throwAnimFrame >= 9) {
                        clearInterval(throwAnim);
                        
                        // Calculate distance between dog and man
                        const dogDistance = Math.abs(dogX - manX);
                        const maxDistance = window.innerWidth * 0.7; // Maximum expected distance
                        
                        // Adjust throw power based on dog distance
                        const distanceFactor = Math.min(1, dogDistance / maxDistance);
                        const throwPower = 8 + Math.random() * 4 + (distanceFactor * 6); // Add up to 6 more power based on distance
                        
                        // Adjust throw angle based on distance (flatter for longer throws)
                        // Frisbees need a slight upward angle to generate lift
                        const throwAngle = 15 + Math.random() * 10 - (distanceFactor * 5); // Lower angle for far throws
                        
                        frisbeeVelocityX = throwPower * Math.cos(throwAngle * Math.PI / 180);
                        frisbeeVelocityY = -throwPower * Math.sin(throwAngle * Math.PI / 180);
                        
                        // Ensure frisbee is set to be level once thrown
                        frisbee.style.transform = `rotate(0deg) rotateX(0deg) rotateY(0deg)`;
                        
                        frisbeeThrown = true;
                        
                        // Reset arm after throw with delay
                        setTimeout(() => {
                            manArm2.style.transform = 'rotate(-45deg)';
                            
                            // Reset legs to original position after a short delay
                            setTimeout(() => {
                                document.getElementById('man-leg1').style.transform = 'rotate(-15deg)';
                                document.getElementById('man-leg2').style.transform = 'rotate(15deg)';
                            }, 300);
                            
                            canThrow = true;
                        }, 500);
                    }
                }, 30);
                
                canThrow = false;
            }
        }
        
        // Update frisbee position and physics
        function updateFrisbee(dt) {
            if (frisbeeActive) {
                frisbeeTimer += dt;
                
                if (frisbeeThrown) {
                    // Apply wind effect
                    const windEffect = (windPercent / 100) * 3 * (Math.sin(frisbeeTimer * 3) + 0.5);
                    
                    // Apply rain effect (makes frisbee heavier/faster)
                    const rainEffect = (rainPercent / 100) * 0.5;
                    
                    // Calculate lift coefficient based on frisbee angle and velocity
                    // Simulating wing-like aerodynamic properties
                    const frisbeeSpeed = Math.sqrt(frisbeeVelocityX * frisbeeVelocityX + frisbeeVelocityY * frisbeeVelocityY);
                    const liftCoefficient = 0.3 * Math.max(0, Math.min(1, frisbeeSpeed / 10));
                    
                    // Apply lift force (acts against gravity)
                    const liftForce = liftCoefficient * frisbeeVelocityX * (1 - rainEffect * 0.5);
                    
                    // Add slight S-curve flight path by varying lift with distance
                    const flightProgress = Math.min(1, frisbeeTimer / 3); // Flight progress from 0-1
                    const liftMultiplier = 1 - Math.pow(2 * flightProgress - 1, 2); // Parabolic curve peaking at middle of flight
                    
                    // Update velocity with all forces
                    frisbeeVelocityX += windEffect * dt;
                    // Apply less gravity due to lift (creates the floating effect)
                    frisbeeVelocityY += (9.8 * (0.8 + rainEffect) - liftForce * liftMultiplier) * dt;
                    
                    // Slowdown as frisbee gets closer to ground
                    const height = window.innerHeight - window.innerHeight * 0.2 - frisbeeY;
                    const groundProximityFactor = Math.max(0, Math.min(1, height / 200));
                    
                    // Reduced air resistance to allow frisbee to travel farther
                    frisbeeVelocityX *= (0.995 - (1 - groundProximityFactor) * 0.02);
                    
                    // Update position
                    frisbeeX += frisbeeVelocityX * 60 * dt;
                    frisbeeY += frisbeeVelocityY * 60 * dt;
                    
                    // Update rotation - frisbee spins primarily around its central axis
                    frisbeeRotation += (frisbeeVelocityX * 10) * dt;
                    // Minimal wobble - almost flat to the ground (max 2 degrees)
                    frisbeeWobble = Math.sin(frisbeeTimer * 4) * (1 - groundProximityFactor) * 2;
                    
                    // Update frisbee position with proper orientation
                    frisbee.style.left = `${frisbeeX - 20}px`;
                    frisbee.style.top = `${frisbeeY - 5}px`;
                    // Flip the frisbee to make it look right-side up
                    frisbee.style.transform = `rotate(0deg) rotateX(180deg) rotateY(0deg)`;
                    
                    // Check if frisbee hits ground
                    if (frisbeeY > window.innerHeight - window.innerHeight * 0.2 - 15) {
                        gameOver();
                    }
                    
                                // Check if dog catches frisbee
                    checkFrisbeeCatch();
                }
                
                // Update timer display
                timerDisplay.textContent = frisbeeTimer.toFixed(1);
            }
        }
        
        // Check if dog catches frisbee
        function checkFrisbeeCatch() {
            // Calculate the center of the frisbee
            const frisbeeHeight = 10;
            const frisbeeWidth = 40;
            const frisbeeCenterX = frisbeeX;
            const frisbeeCenterY = frisbeeY;
            
            // Check if dog catches frisbee
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const catchAreaSize = isMobile ? 35 : 25;
            
            const dogLeft = dogX - catchAreaSize;
            const dogRight = dogX + catchAreaSize;
            const dogTop = dogY - 40 - (isMobile ? 10 : 0);
            
            if (frisbeeCenterX > dogLeft && frisbeeCenterX < dogRight && 
                frisbeeCenterY > dogTop && frisbeeCenterY < dogY) {
                catchFrisbee();
            }
        }
        
        // Catch frisbee function
        function catchFrisbee() {
            score += 100 + Math.floor(1000 / (frisbeeTimer + 1));
            scoreDisplay.textContent = score;
            
            // Visual feedback
            dog.style.backgroundColor = '#A0522D';
            setTimeout(() => {
                dog.style.backgroundColor = '#8B4513';
            }, 200);
            
            // Reset frisbee
            frisbeeActive = false;
            frisbee.style.left = '-100px';
            frisbee.style.top = '-100px';
            
            // Level complete
            levelComplete();
        }
        
        // Create raindrops
        function createRaindrops() {
            // Create new raindrops based on rain percent
            const maxRaindrops = Math.floor(rainPercent * 2);
            const newDropsCount = maxRaindrops - raindrops.length;
            
            for (let i = 0; i < newDropsCount; i++) {
                if (Math.random() < rainPercent / 100) {
                    const raindrop = document.createElement('div');
                    raindrop.className = 'rain-drop';
                    raindrop.style.left = `${Math.random() * window.innerWidth}px`;
                    raindrop.style.top = `${Math.random() * window.innerHeight * 0.3}px`;
                    raindrop.speedY = 5 + Math.random() * 5;
                    raindrop.speedX = (windPercent / 100) * 3 * (Math.random() - 0.3);
                    
                    gameContainer.appendChild(raindrop);
                    raindrops.push(raindrop);
                }
            }
        }
        
        // Update raindrops position
        function updateRaindrops(dt) {
            for (let i = raindrops.length - 1; i >= 0; i--) {
                const drop = raindrops[i];
                let top = parseFloat(drop.style.top);
                let left = parseFloat(drop.style.left);
                
                top += drop.speedY * dt * 60;
                left += drop.speedX * dt * 60;
                
                drop.style.top = `${top}px`;
                drop.style.left = `${left}px`;
                
                // Remove raindrops that hit the ground
                if (top > window.innerHeight - window.innerHeight * 0.2) {
                    gameContainer.removeChild(drop);
                    raindrops.splice(i, 1);
                }
            }
        }
        
        // Game loop
        function gameLoop(timestamp) {
            if (!lastFrameTime) lastFrameTime = timestamp;
            
            // Calculate delta time in seconds
            deltaTime = (timestamp - lastFrameTime) / 1000;
            lastFrameTime = timestamp;
            
            // Limit delta time to prevent large jumps
            if (deltaTime > 0.1) deltaTime = 0.1;
            
            if (gameActive) {
                // Update cooldowns
                if (barkCooldown > 0) {
                    barkCooldown -= deltaTime;
                }
                
                // Update frisbee physics
                updateFrisbee(deltaTime);
                
                // Create and update raindrops
                if (rainPercent > 0) {
                    createRaindrops();
                    updateRaindrops(deltaTime);
                }
                
                // Update cloud positions
                updateClouds(deltaTime);
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Start game function
        function startGame() {
            gameActive = true;
            frisbeeActive = false;
            startScreen.classList.add('hidden');
            
            // Update displays
            updateGameInfo();
            
            // Start game loop if it's not already running
            if (!lastFrameTime) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        // Restart game function
        function restartGame() {
            currentLevel = 1;
            score = 0;
            windPercent = 5;
            rainPercent = 0;
            
            // Clear raindrops
            clearRaindrops();
            
            // Reset frisbee
            frisbeeActive = false;
            frisbee.style.left = '-100px';
            frisbee.style.top = '-100px';
            
            // Update displays
            updateGameInfo();
            
            // Hide game over screen
            gameOverScreen.classList.add('hidden');
            
            // Start game
            gameActive = true;
        }
        
        // Next level function
        function nextLevel() {
            currentLevel++;
            
            // Increase difficulty
            windPercent = 5 * currentLevel;
            
            if (currentLevel > 3) {
                rainPercent = 5 * (currentLevel - 3);
            }
            
            // Clear raindrops
            clearRaindrops();
            
            // Reset frisbee
            frisbeeActive = false;
            frisbee.style.left = '-100px';
            frisbee.style.top = '-100px';
            
            // Update displays
            updateGameInfo();
            
            // Hide level complete screen
            levelCompleteScreen.classList.add('hidden');
            
            // Start game
            gameActive = true;
            
            // Save game progress
            saveGameProgress();
        }
        
        // Go home function
        function goHome() {
            // Hide all screens
            gameOverScreen.classList.add('hidden');
            levelCompleteScreen.classList.add('hidden');
            
            // Show start screen
            startScreen.classList.remove('hidden');
            
            // Reset game state
            gameActive = false;
            
            // Clear raindrops
            clearRaindrops();
            
            // Update high scores
            displayHighScores();
        }
        
        // Game over function
        function gameOver() {
            gameActive = false;
            frisbeeActive = false;
            
            // Update game over stats
            gameOverStats.innerHTML = `You reached level: ${currentLevel}<br>Your score: ${score}`;
            
            // Show game over screen
            gameOverScreen.classList.remove('hidden');
            
            // Save high score
            saveHighScore();
        }
        
        // Level complete function
        function levelComplete() {
            gameActive = false;
            
            // Update level stats
            levelStats.innerHTML = `Level: ${currentLevel}<br>Score: ${score}`;
            
            // Show level complete screen
            levelCompleteScreen.classList.remove('hidden');
            
            // Save game progress
            saveGameProgress();
        }
        
        // Clear raindrops function
        function clearRaindrops() {
            for (const drop of raindrops) {
                gameContainer.removeChild(drop);
            }
            raindrops = [];
        }
        
        // Update game info displays
        function updateGameInfo() {
            levelDisplay.textContent = currentLevel;
            scoreDisplay.textContent = score;
            windDisplay.textContent = `${windPercent}%`;
            rainDisplay.textContent = `${rainPercent}%`;
            timerDisplay.textContent = '0.0';
            
            // Update cloud speeds based on new wind level - much more subtle effect
            if (clouds.length > 0) {
                // Recalculate cloud speeds with minimal wind influence
                cloudSpeeds = cloudSpeeds.map(baseSpeed => {
                    // Very subtle increase with wind
                    return baseSpeed * (1 + windPercent / 500);
                });
            }
        }
        
        // Save game progress
        function saveGameProgress() {
            const gameProgress = {
                level: currentLevel,
                score: score,
                wind: windPercent,
                rain: rainPercent
            };
            
            localStorage.setItem('dogCatchProgress', JSON.stringify(gameProgress));
        }
        
        // Load game progress
        function loadGameProgress() {
            const savedProgress = localStorage.getItem('dogCatchProgress');
            
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                
                currentLevel = progress.level;
                score = progress.score;
                windPercent = progress.wind;
                rainPercent = progress.rain;
                
                updateGameInfo();
            }
        }
        
        // Save high score
        function saveHighScore() {
            let highScores = localStorage.getItem('dogCatchHighScores');
            
            if (!highScores) {
                highScores = [];
            } else {
                highScores = JSON.parse(highScores);
            }
            
            highScores.push({
                level: currentLevel,
                score: score,
                wind: windPercent,
                rain: rainPercent,
                date: new Date().toLocaleDateString()
            });
            
            // Sort by score (highest first)
            highScores.sort((a, b) => b.score - a.score);
            
            // Limit to top 10
            if (highScores.length > 10) {
                highScores = highScores.slice(0, 10);
            }
            
            localStorage.setItem('dogCatchHighScores', JSON.stringify(highScores));
        }
        
        // Display high scores
        function displayHighScores() {
            let highScores = localStorage.getItem('dogCatchHighScores');
            
            // Clear current high scores
            highScoresBody.innerHTML = '';
            
            if (highScores) {
                highScores = JSON.parse(highScores);
                
                for (const score of highScores) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${score.level}</td>
                        <td>${score.score}</td>
                        <td>${score.wind}%</td>
                        <td>${score.rain}%</td>
                    `;
                    highScoresBody.appendChild(row);
                }
            }
        }
        
        // Initialize the game when window loads
        window.onload = initGame;
    </script>
</body>
</html>